angular.module('sticky', [])
// .directive('scroller', ['$timeout','$rootScope', function($timeout, $rootScope){
// 	return {
// 		restrict: 'A',
// 		link: function($scope, $elem, $attrs){
// 			$window = angular.element(window);
// 			var doc = document.documentElement;
// 			var stickyLine = null;
// 			var stickyLineTimeline = null;
// 			var throttledSticky = _.throttle(sticky, 120);
// 			var throttledCheckInfinite = _.throttle(checkInfinite, 120);
// //
// //	S C R O L L   R O U T E R
// //
// 			function scrollRouter(){
// 				$scope.tileMouseLeaveFixed();
// 				$rootScope.scrolling = true;
// 				if($scope.scrollTimeout){
// 					$timeout.cancel( $scope.scrollTimeout );
// 				}
// 				$scope.scrollTimeout = $timeout(function(){
// 					$rootScope.scrolling = false;
// 				},100)


// 				if($rootScope.ctrl === 'searchCtrl'){
// 					throttledSticky();
// 					throttledCheckInfinite()
// 					timeline();
// 				}
// 				else if($rootScope.ctrl === 'pdpCtrl'){
// 					checkPos();
// 				}
// 			}

// //
// //	S T I C K Y
// //
// 			function sticky(){
// 				$window = angular.element(window);
// 				var doc = document.documentElement;
// 				scrollTop = (window.pageYOffset || doc.scrollTop)  - (doc.clientTop || 0);
// 				if(!stickyLine){
// 					stickyLine = $('#grid').offset().top;
// 					stickyLineTimeline = $('.sr_container').last().offset().top;
// 				}

// 				if($window.width() < 480){
// 					var top = 50;
// 				}
// 				else if($window.width() < 640){
// 					var top = 60;
// 				}
// 				else{
// 					var top = 0;
// 				}

// 				if( scrollTop >= stickyLine ){
// 					$('.stickyNavs').css('top', top+'px');
// 					$('.stickyNavs').addClass('stickyNavsStuck');
// 					$('.stickyNavs').css('position', 'fixed');
// 				} 
// 				else {
// 					$('.stickyNavs').css('top', top+'px');
// 					$('.stickyNavs').removeClass('stickyNavsStuck');
// 					$('.stickyNavs').css('position', 'absolute');
// 					$('.stickyNavs').css('overflow','hidden');
// 					stickyLine = $('#grid').offset().top;
// 					stickyLineTimeline = $('.sr_container').last().offset().top;

// 				}
// 			}

// //
// //	I N F I N I T E
// //		
// 			function checkInfinite(){
// 				scrollTop = (window.pageYOffset || doc.scrollTop)  - (doc.clientTop || 0);
// 				var offset = 75;
// 				var height = $window.height();
// 				if(height + scrollTop + offset > $(document).height()){
// 					$scope.infinite();
// 				}
// 			}

// //
// //	S C R O L L S P Y 
// //		
// 			var sections = ['overview','features','richMedia','reviews','related'];
// 			var sectionsLength = sections.length;

// 			function checkPos(){
// 				scrollTop = (window.pageYOffset || doc.scrollTop)  - (doc.clientTop || 0);
// 				for(var i=(sectionsLength-1); i>=0; i--){
// 					var pos = $('#'+sections[i]).offset().top;

// 					if((scrollTop + 50) >= pos){
// 						$scope.activeSection = sections[i];
// 						$scope.$apply();
// 						break;
// 					}
// 				}
// 			}
// //
// //	T I M E L I N E
// //	
// 			var stickyLineTimeline = null;	
// 			$scope.timelineScrollArray = [1000, 2200, 3500, 5000, 7500];
// 			$scope.timelineScrollArrayMap = ["now","in four hours","in one day","in two days","in four days"];
// 			$scope.timelineScrollArrayMapDelivery = ["in four hours","in one day","in two days","in four days", 'in one week'];

// 			var currentArray = 0;

// 			function timeline(){
// 				if(!stickyLineTimeline){
// 					stickyLineTimeline = $('.timelineMarker').first().offset().top;
// 				}
// 			//if($rootScope.ctrl === 'searchCtrl'){
// 				scrollTop = (window.pageYOffset || doc.scrollTop)  - (doc.clientTop || 0);
// 				if($scope.beta){
// 					if($scope.beta.timeline === 'stickyMarkers2' || $scope.beta.timeline === 'stickyMarkers3'){
// 						var shift = 44;
// 					}
// 					else if($scope.beta.timeline === 'stickyMarkersCircle'){
// 						var shift = 150;
// 					}
// 					else if($scope.beta.timeline === 'stickyMarkersCircle2'){
// 						var shift = 150;
// 					}
// 				}
// 				else{
// 					var shift = 44;
// 				}


				
// 				if($scope.beta.timeline === 'stickyMarkersCircle2' && !$scope.throttleTimelineDisplay){
// 					$('.timelineMarkerCircle2').first().show();
// 				}
// 				else{
// 					$('.timelineMarker').first().show();
// 				}

// 				if($scope.timeout && !$scope.throttleTimelineDisplay){
// 					$timeout.cancel( $scope.timeout );
// 				}
// 				if($scope.timeout2 && !$scope.throttleTimelineDisplay){
// 					$timeout.cancel( $scope.timeout2 );
// 				}
				
// 				if($scope.showTimeline && $scope.exactMatch.length > 0){
// 					stickyLineTimeline = $('.sr_container').last().offset().top;
// 				}

// 				var otherItemsBreak = 500000;
// 				if($('.sr_otherItemsBreak').length > 0){
// 					var otherItemsBreak = $('.sr_otherItemsBreak').last().offset().top;
// 				}
				
// 				if ( (scrollTop >= (stickyLineTimeline - 100)) && scrollTop < otherItemsBreak){
// 					if($scope.deliveryOptions && $scope.deliveryOptions[0].showType !== 'unknown'){
// 						$('.timelineMarker').first().css('opacity',1);
// 						$('.timelineMarker').css('opacity',1);
// 						$('.timelineMarker').first().css('position', 'fixed');
// 					}
// 				//
// 				//	Sliding down
// 				//
// 					if($scope.beta.timeline !== 'stickyMarkersCircle2'){
// 						var gridTop = $('#grid').offset().top;
// 						var bottom = $(window).height();
// 						var range = bottom - shift - 100;

// 						var scrollRange = $scope.timelineScrollArray[$scope.timelineScrollArray.length-1] - gridTop + 100;
// 						var ratio = (scrollTop / scrollRange);
// 						var newTop = (ratio * range) + 100;
// 						if(newTop < (bottom-shift)){
// 							$('.timelineMarker').first().css('top', newTop+'px')
// 						}
// 					}

// 				//
// 				//	Fading out
// 				//
// 					if($scope.beta.timeline === 'stickyMarkers2' || $scope.beta.timeline === 'stickyMarkers3'){
// 						var time = 1000;
// 					}
// 					else if($scope.beta.timeline === 'stickyMarkersCircle'){
// 						var time = 500;
// 					}
// 					else if($scope.beta.timeline === 'stickyMarkersCircle2'){
// 						var time = 1500;
// 						//if(!$scope.timeout){
// 						$scope.timeout = $timeout(function(){
// 							$('.timelineMarkerCircle2').first().css('opacity',0)
// 							$scope.timeout2 = $timeout(function(){
// 								$('.timelineMarkerCircle2').first().hide();
// 							},500)
// 						},time)
// 						//}
// 					}

// 					//$scope.timeout = $timeout(function(){
// 						//$('.timelineMarker').first().css('opacity',0)
// 					//},time)
// 				//
// 				//	Changing the inner text.
// 				//
// 					var prevArray = currentArray;
// 					var length = $scope.timelineScrollArray.length;
// 					for(var i=0; i<length; i++){
// 						if(scrollTop < $scope.timelineScrollArray[i]){
// 							currentArray = i;
// 							$scope.currentArray = currentArray;
// 							break;
// 						}
// 					}
					
// 					if(prevArray !== currentArray){
// 						$('.timelineMarker').children('.timelineMarker2Container').children('.timelineMarker2Inner').css('top', -(currentArray * shift)+'px')
// 					}
// 				} 
// 				else {
// 					if($scope.beta.timeline !== 'stickyMarkersCircle2'){
// 						$('.timelineMarker').css('top', '-18px');
// 						$('.timelineMarker').css('position', 'absolute');
// 					}
// 					var gridTop = $('#grid').offset().top;
// 					if(gridTop > scrollTop || scrollTop > otherItemsBreak){
// 						$('.timelineMarker').css('opacity',0)
// 						$('.timelineMarkerCircle2').first().hide();
// 					}
// 				}
// 			}
// // Attach our listeners
// 			var throttled = _.throttle(scrollRouter, 15);
// 			$window.on('scroll', throttled);
// 		},
// 	};
// }])
